<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Google Cloud Study Jams SKNCOE</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, sans-serif;
      background: #f8fafc;
      margin: 0;
      min-height: 100vh;
    }
    .container { max-width: 960px; margin: 0 auto; padding: 28px 8px 28px 8px; }
    .header { text-align: center; margin-bottom: 16px; }
    .header h1 { color: #667eea; font-size: 2.2em; }
    .header p { color: #333; font-weight: 500; }

    .stats-row {
      display: flex; gap: 16px;
      justify-content: center;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }
    .stat-card {
      background: linear-gradient(133deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 11px;
      padding: 1.3em 1.1em;
      text-align: center;
      box-shadow: 0 3px 14px rgba(102,126,234,0.13);
      min-width: 120px;
    }
    .stat-num { font-size: 2.1em; font-weight: bold; margin-top: .18em; }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .tab-btn {
      background: #e0e7ff;
      color: #667eea;
      border: none;
      border-radius: 7px 7px 0 0;
      padding: 8px 22px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 500;
      outline: none;
      transition: background .2s;
    }
    .tab-btn.active, .tab-btn:hover {
      background: #667eea;
      color: white;
    }
    .tab-content {
      background: #fff;
      border-radius: 0 0 11px 11px;
      box-shadow: 0 3px 14px rgba(102,126,234,0.11);
      padding: 16px;
      margin-bottom: 12px;
      min-height: 160px;
    }
    .student-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 11px;
      justify-content: flex-start;
      margin-bottom: 7px;
    }
    .student-card {
      background: #f1f5ff;
      border-radius: 9px;
      padding: 14px 15px 10px 15px;
      min-width: 170px;
      box-shadow: 0 2px 8px rgba(102,126,234,0.07);
      font-size: .95em;
      color: #333;
      transition: box-shadow .2s;
      flex: 1 1 170px;
      max-width: 188px;
    }
    .student-card:hover { box-shadow: 0 5px 26px #667eea22; }
    .student-name { font-weight: bold; color: #667eea; margin-bottom: 3px; font-size: 1.08em; }
    .student-info p { margin: 2px 0; font-size: .95em;}
    .student-small { font-size: .92em; color: #666; margin-top: 6px; }
    .empty-state { color: #999; padding: 25px 0 10px 0; text-align: center; }

    .footer { color: #667eea; text-align: center; margin-top: 24px; font-size: .97em; opacity: 0.9; }
    @media (max-width: 700px) {
      .container { padding: 4px; }
      .stats-row, .student-grid { flex-direction: column; gap: 8px; align-items: center;}
      .student-card { min-width: 90%; max-width: none; }
      .tabs { flex-direction: column; gap: 2px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ Google Cloud Study Jams SKNCOE</h1>
      <p>Participant Dashboard ‚Äî <span id="lastUpdated">Loading...</span></p>
    </div>
    <div class="stats-row">
      <div class="stat-card">Total Students<div class="stat-num" id="totalStudents">0</div></div>
      <div class="stat-card">All Complete<div class="stat-num" id="allCompleted">0</div></div>
      <div class="stat-card">Arcade Players<div class="stat-num" id="arcadeCount">0</div></div>
      <div class="stat-card">Badge Hunters<div class="stat-num" id="badgeCount">0</div></div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" data-section="leaderboard">Leaderboard</button>
      <button class="tab-btn" data-section="arcade">Arcade Champions</button>
      <button class="tab-btn" data-section="badges">Badge Hunters</button>
      <button class="tab-btn" data-section="nocompletion">Just Getting Started</button>
    </div>
    <div class="tab-content">
      <div id="leaderboardSection" class="tab-panel" style="display:block"></div>
      <div id="arcadeSection" class="tab-panel" style="display:none"></div>
      <div id="badgesSection" class="tab-panel" style="display:none"></div>
      <div id="nocompletionSection" class="tab-panel" style="display:none"></div>
    </div>
    <div class="footer">
      Made with ‚ù§Ô∏è at SKNCOE Cloud Study Jams
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script>
    let allTabs = ['leaderboard', 'arcade', 'badges', 'nocompletion'];
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.onclick = function() {
        allTabs.forEach(tab => {
          document.getElementById(tab + 'Section').style.display = (tab === this.dataset.section) ? 'block' : 'none';
          document.querySelector('[data-section="' + tab + '"]').classList.toggle('active', tab === this.dataset.section);
        });
      }
    });

    async function fetchCsvData() {
      try {
        const response = await fetch('/latestData.csv');
        const csv = await response.text();
        Papa.parse(csv, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            const allStudents = results.data.filter(row => row["User Name"]);
            // All Complete: badges & arcade
            const leaderboard = allStudents.filter(row =>
              row["All Skill Badges & Games Completed"] &&
              row["All Skill Badges & Games Completed"].trim().toLowerCase() === "yes"
            );
            // Arcade Champions: arcade > 0, not all complete
            const arcadeChamps = allStudents.filter(row =>
              parseInt(row["# of Arcade Games Completed"]) > 0 &&
              (!row["All Skill Badges & Games Completed"] || row["All Skill Badges & Games Completed"].trim().toLowerCase() !== "yes")
            );
            // Badge Hunters: badges > 0, arcade 0, not all complete
            const badgeHunters = allStudents.filter(row =>
              parseInt(row["# of Skill Badges Completed"]) > 0 &&
              (!row["# of Arcade Games Completed"] || parseInt(row["# of Arcade Games Completed"]) === 0) &&
              (!row["All Skill Badges & Games Completed"] || row["All Skill Badges & Games Completed"].trim().toLowerCase() !== "yes")
            );
            // No Progress: badges 0, arcade 0
            const noProgress = allStudents.filter(row =>
              (!row["# of Skill Badges Completed"] || parseInt(row["# of Skill Badges Completed"]) === 0) &&
              (!row["# of Arcade Games Completed"] || parseInt(row["# of Arcade Games Completed"]) === 0)
            );

            document.getElementById('totalStudents').textContent = allStudents.length;
            document.getElementById('allCompleted').textContent = leaderboard.length;
            document.getElementById('arcadeCount').textContent = arcadeChamps.length;
            document.getElementById('badgeCount').textContent = badgeHunters.length;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();

            renderCards('leaderboardSection', leaderboard);
            renderCards('arcadeSection', arcadeChamps);
            renderCards('badgesSection', badgeHunters);
            renderCards('nocompletionSection', noProgress);
          }
        });
      } catch (error) {
        allTabs.forEach(tab =>
          document.getElementById(tab + 'Section').innerHTML = '<div class="empty-state">Error loading data. Please refresh.</div>'
        );
      }
    }

    function renderCards(sectionId, students) {
      const section = document.getElementById(sectionId);
      if (students.length === 0) {
        section.innerHTML = '<div class="empty-state">No students in this category yet.</div>';
        return;
      }
      section.innerHTML =
        '<div class="student-grid">' +
        students.map((s, idx) => `
          <div class="student-card" title="${s["User Name"]}">
            <div class="student-name">${idx+1}. ${s["User Name"]}</div>
            <div class="student-info">
              <p><strong>Badges:</strong> ${s["# of Skill Badges Completed"] || 0}</p>
              <p><strong>Arcade:</strong> ${s["# of Arcade Games Completed"] || 0}</p>
              <div class="student-small">${s["User Email"] || ""}</div>
            </div>
          </div>
        `).join('') +
        '</div>';
    }
    fetchCsvData();
    setInterval(fetchCsvData, 25000);
  </script>
</body>
</html>
