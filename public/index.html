<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Google Cloud Study Jams SKNCOE</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, sans-serif; background: #f7fafd; margin: 0; min-height: 100vh; overflow-x: hidden; }
    #splash { position: fixed; z-index: 9999; top: 0; left: 0; right: 0; bottom: 0; background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 1.2s cubic-bezier(.77,0,.18,1); }
    #splash.hide { opacity: 0; pointer-events: none; }
    .gcloud-anim { width: 120px; margin-bottom: 32px; animation: cloudfloat 2.5s; border-radius: 22px; box-shadow: 0 8px 38px #67eaea22; }
    @keyframes cloudfloat { 0%{transform:translateY(-50px) scale(0.23);} 45%{transform:translateY(0px) scale(1.08);} 77%{transform:scale(1.13);} 100%{transform:scale(1);} }
    .typewriter { font-size: 2.1em; font-weight: 600; color: #4285F4; letter-spacing: 2px; border-right: .12em solid #4285F4; white-space: nowrap; overflow: hidden; width: 0; animation: typing 2.5s steps(36, end) forwards, blink-caret .8s infinite; margin-bottom: 20px; }
    @keyframes typing { from { width: 0 } to { width: 27ch } }
    @keyframes blink-caret { 0%,100% { border-color: transparent } 50% { border-color: #4285F4 } }

    .container { max-width: 98vw; margin: 0 auto; padding: 30px 15px 30px 15px; }
    .nav-bar { display: flex; gap: 15px; align-items: center; justify-content: flex-end; background: #fff; box-shadow: 0 4px 16px #e0e7ff44; padding: 14px 22px 10px 22px; border-radius: 0 0 14px 14px; margin-bottom: 7px; font-size: 1.10em; }
    .nav-link { color: #4285F4; text-decoration: none; font-weight: 600; padding: 7px 13px; border-radius:7px;}
    .nav-link:hover { background: #e0e7ff;}
    .syllabus-link{color:#fff; background:#4285F4; border-radius:6px; padding:6px 18px; text-decoration:none; font-weight:600; margin-left:6px;}
    .syllabus-link:hover{background:#667eea;}
    .header { text-align: center; margin-bottom: 19px; }
    .header h1 { color: #667eea; font-size: 2.35em; font-weight: 650; margin-bottom: 7px;}
    .header p { color: #333; font-weight: 500; margin:6px 0 0 0; }
    .stats-row { display: flex; gap: 14px; justify-content: center; margin-bottom: 19px; flex-wrap: wrap;}
    .stat-card { background: linear-gradient(133deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 11px; padding: 1.11em .9em; text-align: center; min-width: 170px; flex: 1 1 170px; box-shadow: 0 3px 13px #667eea22;}
    .stat-num{ font-size:2em; font-weight:bold; margin-top:.13em;}
    .countdown { font-size: 1.19em; font-weight: 600; color: #ef4444; background: #fffbef; padding: 7px 22px 7px 22px; border-radius: 9px; box-shadow: 0 2px 8px #fde68a11; display: inline-block; margin-bottom: 17px; margin-top: -4px;}
    .tabs { display: flex; justify-content: center; gap: 6px; margin-bottom: 10px;}
    .tab-btn { background: #e0e7ff; color: #667eea; border: none; border-radius: 8px 8px 0 0; padding: 10px 34px; cursor: pointer; font-size:1.08em; font-weight:600; transition: background .13s;}
    .tab-btn.active,.tab-btn:hover { background:#4285F4; color:#fff;}
    .tab-content { background:#fff; border-radius:0 0 13px 13px; box-shadow:0 2.5px 13px #667eea15; padding:26px 14px; margin-bottom:14px; min-height:176px;}
    .student-grid { display:grid; grid-gap:24px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); justify-items:center; align-items:start; width:100%; margin:0 auto;}
    .student-card { background:#f1f6ff; border-radius:12px; padding:16px 18px 14px 18px; min-width:190px; font-size:1.08em; color:#333; transition:box-shadow .2s; width:100%; max-width:255px; cursor:pointer; text-align:center; box-shadow:0 2px 12px #667eea08;}
    .student-card:hover { box-shadow:0 12px 36px #667eea26; }
    .student-name { font-weight:700; color:#4285F4; margin-bottom:7px; font-size:1.13em;}
    .student-small{ font-size:.97em; color:#666; margin-top:7px;}
    .empty-state{ color: #999; padding: 25px 0 10px 0; text-align:center;}
    .footer{color:#667eea; text-align:center; margin-top:24px; font-size:1.04em; opacity:0.92;}
    #modal {position:fixed;top:0;left:0;width:100vw;height:100vh;display:none;z-index:9999;background:rgba(44,62,80,0.15);}
    #modal .modal-content { max-width:400px; background:#fff; border-radius:15px; box-shadow:0 12px 54px #667eea23; margin:80px auto; padding:35px 35px 23px 35px; position:relative; text-align:center; animation:fadein .41s;}
    #modal-close {position:absolute;top:13px;right:24px;font-size:1.8em;cursor:pointer;color:#888;}
    #modal-table {width:100%;border-collapse:collapse;margin:0 auto;}
    #modal-table td, #modal-table th {padding:7px 7px;text-align:left;}
    #modal-table th {font-weight:600;background:#f1f6ff;color:#4285F4;}
    #modal-table tr {border-bottom:1.5px solid #e0e7ff;}
    #modal-table tr:last-child {border-bottom:none;}
    @media(max-width:920px){.tab-content{padding:14px 1vw; min-height:120px;}
      .student-grid{grid-gap:9px;}}
    @media(max-width:700px){.container{padding:3px;}
      .nav-bar{padding:7px 7px 7px 7px;}
      .stats-row{gap:7px;}
      .student-grid{grid-template-columns:repeat(auto-fit,minmax(97vw,1fr));}
      .student-card{min-width:96vw;max-width:none;}
      #modal .modal-content {margin:36px auto;max-width:98vw;}
    }
  </style>
</head>
<body>
  <div id="splash">
    <img src="https://www.netapp.com/media/web-cards-description-Google-Cloud_tcm19-15812.jpg?v=14971" class="gcloud-anim" alt="Google Cloud Logo"/>
    <div class="typewriter" id="typewriter-text"></div>
  </div>
  <div class="container" style="display:none;" id="mainContent">
    <div class="nav-bar">
      <a class="nav-link" href="/">Home</a>
      <span class="nav-right"></span>
      <a class="syllabus-link" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vRB406SGkUY4Q5jRqYBSZqRGfsK6MsESzdtbHaoXnYT3isC2CcBFrloYq3gcO61Gbw58qSw9RB4FXoM/pubhtml?gid=0&single=true" target="_blank">View Syllabus</a>
    </div>
    <div class="header">
      <h1>üöÄ Google Cloud Study Jams SKNCOE</h1>
      <p>Participant Dashboard ‚Äî <span id="lastUpdated">Loading...</span></p>
      <div id="countdown" class="countdown"></div>
    </div>
    <div class="stats-row">
      <div class="stat-card">Total Students<div class="stat-num" id="totalStudents">0</div></div>
      <div class="stat-card">All Complete<div class="stat-num" id="allCompleted">0</div></div>
      <div class="stat-card">Arcade Players<div class="stat-num" id="arcadeCount">0</div></div>
      <div class="stat-card">Badge Hunters<div class="stat-num" id="badgeCount">0</div></div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" data-section="leaderboard">Leaderboard</button>
      <button class="tab-btn" data-section="arcade">Arcade Champions</button>
      <button class="tab-btn" data-section="badges">Badge Hunters</button>
      <button class="tab-btn" data-section="nocompletion">Just Getting Started</button>
    </div>
    <div class="tab-content">
      <div id="leaderboardSection" class="tab-panel" style="display:block"></div>
      <div id="arcadeSection" class="tab-panel" style="display:none"></div>
      <div id="badgesSection" class="tab-panel" style="display:none"></div>
      <div id="nocompletionSection" class="tab-panel" style="display:none"></div>
    </div>
    <div class="footer">Made with ‚ù§Ô∏è at SKNCOE Cloud Study Jams</div>
  </div>
  <div id="modal">
    <div class="modal-content">
      <span id="modal-close">&times;</span>
      <div id="modal-details"></div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script>
    // Splash Animation and Typewriter
    const splashDelay = 5000;
    const typewriterText = "Google Cloud Study Jams SKNCOE";
    let typewriterIndex = 0;
    function typeWriterEffect() {
      if (typewriterIndex <= typewriterText.length) {
        document.getElementById("typewriter-text").textContent = typewriterText.substring(0, typewriterIndex);
        typewriterIndex++;
        setTimeout(typeWriterEffect, 60);
      }
    }
    typeWriterEffect();
    setTimeout(() => {
      document.getElementById('splash').classList.add('hide');
      setTimeout(() => {
        document.getElementById('mainContent').style.display='block';
      }, 1200);
    }, splashDelay);

    // Tabs
    let allTabs = ['leaderboard','arcade','badges','nocompletion'];
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.onclick=function(){
        allTabs.forEach(tab=>{
          document.getElementById(tab+'Section').style.display=(tab===this.dataset.section)?'block':'none';
          document.querySelector('[data-section="'+tab+'"]').classList.toggle('active',tab===this.dataset.section);
        });
      }
    });

    // Countdown
    function updateCountdown() {
      // Last date: 19 Nov 2025 23:59:59
      const lastDate = new Date(2025, 10, 19, 23, 59, 59); // Month is 0-indexed
      const now = new Date();
      const diff = lastDate - now;
      if(diff<0) document.getElementById('countdown').innerText = "Program Ended!";
      else {
        const days = Math.floor(diff/(1000*60*60*24));
        const hours = Math.floor((diff/(1000*60*60))%24);
        const mins = Math.floor((diff/(1000*60))%60);
        document.getElementById('countdown').innerText =
          `Time remaining: ${days} day${days===1?'':'s'}, ${hours} hour${hours===1?'':'s'}, ${mins} min${mins===1?'':'s'}`;
      }
    }
    setInterval(updateCountdown, 1000); updateCountdown();

    // Modal Logic
    function showModal(student) {
      const modalRows = [
        ["Name", student["User Name"]],
        ["Email", student["User Email"]],
        ["Badges Completed", student["# of Skill Badges Completed"]||0],
        ["Arcade Games Completed", student["# of Arcade Games Completed"]||0],
        ["Google Cloud Profile", `<a href="${student["Google Cloud Skills Boost Profile URL"]||'#'}" target="_blank">${student["Google Cloud Skills Boost Profile URL"]||'N/A'}</a>`],
        ["Status", student["Profile URL Status"]||''],
        ["Skill Badges Names", student["Names of Completed Skill Badges"]||''],
        ["Arcade Game Names", student["Names of Completed Arcade Games"]||'']
      ];
      let html = `<table id="modal-table">`;
      modalRows.forEach(([key,val])=>{
        html+=`<tr><th>${key}</th><td>${val}</td></tr>`;
      });
      html += "</table>";
      document.getElementById('modal-details').innerHTML=html;
      document.getElementById('modal').style.display='block';
    }
    document.getElementById('modal-close').onclick=function(){
      document.getElementById('modal').style.display='none';
    }
    window.onclick=function(e){
      if(e.target==document.getElementById('modal')) document.getElementById('modal').style.display='none';
    };

    // CSV & Cards
    async function fetchCsvData() {
      try {
        const response = await fetch('/latestData.csv');
        const csv = await response.text();
        Papa.parse(csv, {
          header: true, skipEmptyLines: true,
          complete: function(results){
            const allStudents = results.data.filter(row=>row["User Name"]);
            // All Complete
            const leaderboard = allStudents.filter(row =>
              row["All Skill Badges & Games Completed"] &&
              row["All Skill Badges & Games Completed"].trim().toLowerCase() === "yes");
            // Arcade Champions
            const arcadeChamps = allStudents.filter(row =>
              parseInt(row["# of Arcade Games Completed"]) > 0 &&
              (!row["All Skill Badges & Games Completed"] || row["All Skill Badges & Games Completed"].trim().toLowerCase() !== "yes"));
            // Badge Hunters
            const badgeHunters = allStudents.filter(row =>
              parseInt(row["# of Skill Badges Completed"]) > 0 &&
              (!row["# of Arcade Games Completed"] || parseInt(row["# of Arcade Games Completed"]) === 0) &&
              (!row["All Skill Badges & Games Completed"] || row["All Skill Badges & Games Completed"].trim().toLowerCase() !== "yes"));
            // No Progress
            const noProgress = allStudents.filter(row =>
              (!row["# of Skill Badges Completed"] || parseInt(row["# of Skill Badges Completed"]) === 0) &&
              (!row["# of Arcade Games Completed"] || parseInt(row["# of Arcade Games Completed"]) === 0));

            document.getElementById('totalStudents').textContent = allStudents.length;
            document.getElementById('allCompleted').textContent = leaderboard.length;
            document.getElementById('arcadeCount').textContent = arcadeChamps.length;
            document.getElementById('badgeCount').textContent = badgeHunters.length;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();

            renderCards('leaderboardSection', leaderboard);
            renderCards('arcadeSection', arcadeChamps);
            renderCards('badgesSection', badgeHunters);
            renderCards('nocompletionSection', noProgress);
          }
        });
      } catch (error) {
        allTabs.forEach(tab =>
          document.getElementById(tab+'Section').innerHTML='<div class="empty-state">Error loading data. Please refresh.</div>');
      }
    }
    function renderCards(sectionId, students){
      const section=document.getElementById(sectionId);
      if(students.length===0){
        section.innerHTML='<div class="empty-state">No students in this category yet.</div>'; return;
      }
      section.innerHTML=
        '<div class="student-grid">'+
        students.map((s,idx)=>`
          <div class="student-card" title="${s["User Name"]}" onclick='window.showModalData(${idx},"${sectionId}")'>
            <div class="student-name">${idx+1}. ${s["User Name"]}</div>
            <div class="student-small">${s["User Email"]||""}</div>
            <div class="student-small">Badges: ${s["# of Skill Badges Completed"]||0}, Arcade: ${s["# of Arcade Games Completed"]||0}</div>
          </div>
        `).join('') + '</div>';
      window.modalData = students;
    }
    window.showModalData = function(idx,sectionId){
      showModal(window.modalData[idx]);
    };
    fetchCsvData();
    setInterval(fetchCsvData, 25000);
  </script>
</body>
</html>
