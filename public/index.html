<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Google Cloud Study Jams SKNCOE</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, sans-serif;
      background: #f7fafd;
      margin: 0; min-height: 100vh;
      overflow-x: hidden;
    }
    #splash {
      position: fixed;
      z-index: 9999;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #fff;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      transition: opacity 1.2s cubic-bezier(.77,0,.18,1);
    }
    #splash.hide { opacity: 0; pointer-events: none; }
    .gcloud-anim {
      width: 110px; margin-bottom: 28px; animation: cloudfloat 2.5s;
    }
    @keyframes cloudfloat {
      0%{transform:translateY(-40px) scale(0.2);}
      45%{transform:translateY(0px) scale(1.05);}
      77%{transform:scale(1.12);}
      100%{transform:scale(1);}
    }
    .typewriter {
      font-size: 2.1em; font-weight: 600; color: #4285F4; letter-spacing: 2px;
      border-right: .1em solid #4285F4;
      white-space: nowrap; overflow: hidden;
      width: 0; animation: typing 2.5s steps(36, end) forwards, blink-caret .8s infinite;
      margin-bottom: 20px;
    }
    @keyframes typing {
      from { width: 0 }
      to { width: 27ch }
    }
    @keyframes blink-caret {
      0%,100% { border-color: transparent }
      50% { border-color: #4285F4 }
    }

    .container { max-width: 96vw; margin: 0 auto; padding: 28px 15px 28px 15px;}
    .nav-bar {
      display: flex; gap: 16px; align-items: center;
      justify-content: flex-end; background: #fff;
      box-shadow: 0 4px 16px #e0e7ff44;
      padding: 14px 22px 10px 22px;
      border-radius: 0 0 18px 18px;
      margin-bottom: 7px;
      font-size: 1.15em;
    }
    .nav-link { color: #4285F4; text-decoration: none; font-weight: 600; padding: 7px 13px; border-radius:7px;}
    .nav-link:hover { background: #e0e7ff;}
    .syllabus-link{color:#fff; background:#4285F4; border-radius:6px; padding:5px 15px; text-decoration:none; font-weight:600;margin-left:6px;}
    .syllabus-link:hover{background:#667eea;}
    .header { text-align: center; margin-bottom: 17px; }
    .header h1 { color: #667eea; font-size: 2.4em; font-weight: 650; margin-bottom: 7px;}
    .header p { color: #333; font-weight: 500; margin:6px 0 0 0; }
    .stats-row {
      display: flex; gap: 16px; justify-content: center; margin-bottom: 18px; flex-wrap: wrap;
    }
    .stat-card {
      background: linear-gradient(133deg, #667eea 0%, #764ba2 100%);
      color: white; border-radius: 11px;
      padding: 1.15em 1em; text-align: center;
      min-width: 180px; flex: 1 1 180px;
      box-shadow: 0 3px 12px #667eea22;
    }
    .stat-num{ font-size:2.09em; font-weight:bold; margin-top:.18em;}
    .countdown {
      font-size: 1.25em; font-weight: 600; color: #ef4444;
      background: #fffbef; padding: 8px 24px 8px 24px;
      border-radius: 9px; box-shadow: 0 2px 8px #fde68a11;
      display: inline-block; margin-bottom: 16px;
      margin-top: -2px;
    }
    .tabs { display: flex; justify-content: center; gap: 7px; margin-bottom: 10px;}
    .tab-btn {
      background: #e0e7ff; color: #667eea;
      border: none; border-radius: 8px 8px 0 0;
      padding: 10px 34px; cursor: pointer;
      font-size:1.1em; font-weight:600;
      transition: background .15s;
    }
    .tab-btn.active,.tab-btn:hover {
      background:#4285F4; color:#fff;
    }
    .tab-content { background:#fff; border-radius:0 0 13px 13px;
      box-shadow:0 2px 12px #667eea18; padding:21px 10px; margin-bottom:14px; min-height:164px;}
    .student-grid {
      display:grid; grid-gap:22px;
      grid-template-columns: repeat(auto-fit, minmax(188px, 1fr));
      justify-items: center; align-items:start;
      width: 100%; margin: 0 auto;
    }
    .student-card {
      background:#f1f6ff; border-radius:12px; padding:14px 16px 10px 16px;
      min-width:166px; box-shadow:0 2px 8px #667eea08;
      font-size:.98em; color:#333; transition:box-shadow .2s;
      width:100%; max-width:220px;
      cursor:pointer; position:relative; text-align: center;
    }
    .student-card:hover { box-shadow:0 12px 36px #667eea20; }
    .student-name { font-weight:700; color:#4285F4; margin-bottom:2px; font-size:1.09em;}
    .student-small{ font-size:.93em; color:#666; margin-top:6px;}
    .empty-state{ color: #999; padding: 25px 0 10px 0; text-align:center;}
    .footer{color:#667eea; text-align:center; margin-top:24px; font-size:.99em; opacity:0.9;}
    #modal {position:fixed;top:0;left:0;width:100vw;height:100vh;display:none;z-index:9999;background:rgba(44,62,80,0.16);}
    #modal .modal-content {
      max-width:390px; background:#fff; border-radius:15px;
      box-shadow:0 12px 54px #667eea2a; margin:80px auto;
      padding:32px 32px 18px 32px;
      position:relative; text-align:center; animation:fadein .41s;
    }
    #modal-close {position:absolute;top:11px;right:24px;font-size:1.7em;cursor:pointer;color:#888;}
    #modal-details p {margin:8px 0 6px 0; font-size:1em;}
    #modal-details a {color:#4285F4; text-decoration:none;}
    @media(max-width:920px){
      .container{max-width:99vw;}
      .tab-content{padding:14px 0; min-height:120px;}
      .student-grid{grid-gap:12px;}
    }
    @media(max-width:700px){
      .container{padding:3px;}
      .nav-bar{padding:8px 7px 8px 7px; font-size:1em;}
      .stats-row{gap:9px;}
      .student-grid{grid-template-columns:repeat(auto-fit,minmax(93vw,1fr));}
      .student-card{min-width:92vw;max-width:none;}
      .tabs{flex-direction:column;gap:2px;}
      #modal .modal-content {margin:43px auto;max-width:97vw;}
    }
  </style>
</head>
<body>
  <div id="splash">
    <!-- Google Cloud SVG (animated) -->
    <svg class="gcloud-anim" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 195"><g>
    <path fill="#4285F4" d="M204.3,147.3c-5.8,15-20.4,25.9-37.8,25.9h-89c-23,0-41-20.2-38.1-43,2.2-17.7,17.9-30.7,35.7-30.7h6.2c3.3-32.2,30.2-57,62.8-57c25.2,0,47,15,57,36.7c11.9-6.3,26.3-1.1,32.6,10.9C243.9,117.9,228.8,142.2,204.3,147.3z"/></g>
    <circle fill="#EA4335" cx="50" cy="129" r="28"/><circle fill="#FBBC05" cx="128" cy="63" r="28"/><circle fill="#34A853" cx="134" cy="148" r="28"/></svg>
    <div class="typewriter" id="typewriter-text"></div>
  </div>
  <div class="container" style="display:none;" id="mainContent">
    <div class="nav-bar">
      <a class="nav-link" href="/">Home</a>
      <span class="nav-right"></span>
      <a class="syllabus-link" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vRB406SGkUY4Q5jRqYBSZqRGfsK6MsESzdtbHaoXnYT3isC2CcBFrloYq3gcO61Gbw58qSw9RB4FXoM/pubhtml?gid=0&single=true" target="_blank">View Syllabus</a>
    </div>
    <div class="header">
      <h1>üöÄ Google Cloud Study Jams SKNCOE</h1>
      <p>Participant Dashboard ‚Äî <span id="lastUpdated">Loading...</span></p>
      <div id="countdown" class="countdown"></div>
    </div>
    <div class="stats-row">
      <div class="stat-card">Total Students<div class="stat-num" id="totalStudents">0</div></div>
      <div class="stat-card">All Complete<div class="stat-num" id="allCompleted">0</div></div>
      <div class="stat-card">Arcade Players<div class="stat-num" id="arcadeCount">0</div></div>
      <div class="stat-card">Badge Hunters<div class="stat-num" id="badgeCount">0</div></div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" data-section="leaderboard">Leaderboard</button>
      <button class="tab-btn" data-section="arcade">Arcade Champions</button>
      <button class="tab-btn" data-section="badges">Badge Hunters</button>
      <button class="tab-btn" data-section="nocompletion">Just Getting Started</button>
    </div>
    <div class="tab-content">
      <div id="leaderboardSection" class="tab-panel" style="display:block"></div>
      <div id="arcadeSection" class="tab-panel" style="display:none"></div>
      <div id="badgesSection" class="tab-panel" style="display:none"></div>
      <div id="nocompletionSection" class="tab-panel" style="display:none"></div>
    </div>
    <div class="footer">Made with ‚ù§Ô∏è at SKNCOE Cloud Study Jams</div>
  </div>
  <div id="modal">
    <div class="modal-content">
      <span id="modal-close">&times;</span>
      <div id="modal-details"></div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script>
    // Splash Animation and Typewriter
    const splashDelay = 5000;
    const typewriterText = "Google Cloud Study Jams SKNCOE";
    let typewriterIndex = 0;
    function typeWriterEffect() {
      if (typewriterIndex <= typewriterText.length) {
        document.getElementById("typewriter-text").textContent = typewriterText.substring(0, typewriterIndex);
        typewriterIndex++;
        setTimeout(typeWriterEffect, 60);
      }
    }
    typeWriterEffect();
    setTimeout(() => {
      document.getElementById('splash').classList.add('hide');
      setTimeout(() => {
        document.getElementById('mainContent').style.display='block';
      }, 1200);
    }, splashDelay);

    // Tabs
    let allTabs = ['leaderboard','arcade','badges','nocompletion'];
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.onclick=function(){
        allTabs.forEach(tab=>{
          document.getElementById(tab+'Section').style.display=(tab===this.dataset.section)?'block':'none';
          document.querySelector('[data-section="'+tab+'"]').classList.toggle('active',tab===this.dataset.section);
        });
      }
    });

    // Countdown
    function updateCountdown() {
      // Last date: 19 Nov 2025 23:59:59
      const lastDate = new Date(2025, 10, 19, 23, 59, 59); // Month is 0-indexed
      const now = new Date();
      const diff = lastDate - now;
      if(diff<0) document.getElementById('countdown').innerText = "Program Ended!";
      else {
        const days = Math.floor(diff/(1000*60*60*24));
        const hours = Math.floor((diff/(1000*60*60))%24);
        const mins = Math.floor((diff/(1000*60))%60);
        document.getElementById('countdown').innerText =
          `Time remaining: ${days} day${days===1?'':'s'}, ${hours} hour${hours===1?'':'s'}, ${mins} min${mins===1?'':'s'}`;
      }
    }
    setInterval(updateCountdown, 1000); updateCountdown();

    // Modal Logic
    function showModal(student) {
      const details = `
        <div style="margin-bottom:10px;">
          <div style="font-size:1.23em;font-weight:bold;color:#4285F4;">${student["User Name"]}</div>
        </div>
        <div id="modal-info">
          <p><strong>Email:</strong> ${student["User Email"]}</p>
          <p><strong>Skill Badges:</strong> ${student["# of Skill Badges Completed"]||0}</p>
          <p><strong>Arcade Games:</strong> ${student["# of Arcade Games Completed"]||0}</p>
          <p><strong>Google Cloud Profile:</strong> <br>
            <a href="${student["Google Cloud Skills Boost Profile URL"]||'#'}" target="_blank">${student["Google Cloud Skills Boost Profile URL"]||'N/A'}</a>
          </p>
          <p><strong>Status:</strong> ${student["Profile URL Status"]||''}</p>
          <p><strong>Skill Badges Names:</strong> <br>${student["Names of Completed Skill Badges"]||''}</p>
          <p><strong>Arcade Game Names:</strong> <br>${student["Names of Completed Arcade Games"]||''}</p>
        </div>`;
      document.getElementById('modal-details').innerHTML=details;
      document.getElementById('modal').style.display='block';
    }
    document.getElementById('modal-close').onclick=function(){
      document.getElementById('modal').style.display='none';
    }
    window.onclick=function(e){
      if(e.target==document.getElementById('modal')) document.getElementById('modal').style.display='none';
    };

    // CSV & Cards
    async function fetchCsvData() {
      try {
        const response = await fetch('/latestData.csv');
        const csv = await response.text();
        Papa.parse(csv, {
          header: true, skipEmptyLines: true,
          complete: function(results){
            const allStudents = results.data.filter(row=>row["User Name"]);
            // All Complete
            const leaderboard = allStudents.filter(row =>
              row["All Skill Badges & Games Completed"] &&
              row["All Skill Badges & Games Completed"].trim().toLowerCase() === "yes");
            // Arcade Champions
            const arcadeChamps = allStudents.filter(row =>
              parseInt(row["# of Arcade Games Completed"]) > 0 &&
              (!row["All Skill Badges & Games Completed"] || row["All Skill Badges & Games Completed"].trim().toLowerCase() !== "yes"));
            // Badge Hunters
            const badgeHunters = allStudents.filter(row =>
              parseInt(row["# of Skill Badges Completed"]) > 0 &&
              (!row["# of Arcade Games Completed"] || parseInt(row["# of Arcade Games Completed"]) === 0) &&
              (!row["All Skill Badges & Games Completed"] || row["All Skill Badges & Games Completed"].trim().toLowerCase() !== "yes"));
            // No Progress
            const noProgress = allStudents.filter(row =>
              (!row["# of Skill Badges Completed"] || parseInt(row["# of Skill Badges Completed"]) === 0) &&
              (!row["# of Arcade Games Completed"] || parseInt(row["# of Arcade Games Completed"]) === 0));

            document.getElementById('totalStudents').textContent = allStudents.length;
            document.getElementById('allCompleted').textContent = leaderboard.length;
            document.getElementById('arcadeCount').textContent = arcadeChamps.length;
            document.getElementById('badgeCount').textContent = badgeHunters.length;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();

            renderCards('leaderboardSection', leaderboard);
            renderCards('arcadeSection', arcadeChamps);
            renderCards('badgesSection', badgeHunters);
            renderCards('nocompletionSection', noProgress);
          }
        });
      } catch (error) {
        allTabs.forEach(tab =>
          document.getElementById(tab+'Section').innerHTML='<div class="empty-state">Error loading data. Please refresh.</div>');
      }
    }
    function renderCards(sectionId, students){
      const section=document.getElementById(sectionId);
      if(students.length===0){
        section.innerHTML='<div class="empty-state">No students in this category yet.</div>'; return;
      }
      section.innerHTML=
        '<div class="student-grid">'+
        students.map((s,idx)=>`
          <div class="student-card" title="${s["User Name"]}" onclick='window.showModalData(${idx},"${sectionId}")'>
            <div class="student-name">${idx+1}. ${s["User Name"]}</div>
            <div class="student-small">${s["User Email"]||""}</div>
            <div class="student-small">Badges: ${s["# of Skill Badges Completed"]||0}, Arcade: ${s["# of Arcade Games Completed"]||0}</div>
          </div>
        `).join('') + '</div>';
      window.modalData = students;
    }
    window.showModalData = function(idx,sectionId){
      showModal(window.modalData[idx]);
    };
    fetchCsvData();
    setInterval(fetchCsvData, 25000);
  </script>
</body>
</html>
